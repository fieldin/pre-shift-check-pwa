<!--
  Settings Component Template
  
  User settings and app configuration.
  Handles operator identity, sync, and data management.
-->

<div class="settings-page">
  <!-- Header -->
  <header class="header">
    <button class="back-btn" routerLink="/">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
    </button>
    <h1>Settings</h1>
  </header>

  <main class="main-content">
    <!-- Operator Identity Section -->
    <section class="section">
      <h2 class="section-title">Operator Identity</h2>
      <div class="card">
        <div class="form-group">
          <label class="form-label">Your Name <span class="required">*</span></label>
          <input
            type="text"
            [(ngModel)]="reporterName"
            placeholder="Enter your name"
            class="form-control"
          />
        </div>
        <div class="form-group">
          <label class="form-label">User ID (optional)</label>
          <input
            type="text"
            [(ngModel)]="reporterUserId"
            placeholder="e.g., USR001"
            class="form-control"
          />
        </div>
        <button
          class="btn btn-primary"
          (click)="saveReporter()"
          [disabled]="!reporterName.trim()"
        >
          Save Identity
        </button>
      </div>
    </section>

    <!-- Data & Sync Section -->
    <section class="section">
      <h2 class="section-title">Data & Sync</h2>
      <div class="card">
        <div class="info-row">
          <span class="info-label">Last Sync</span>
          <span class="info-value">
            {{ db.lastSyncAt() ? utils.formatFullDate(db.lastSyncAt()!) : 'Never' }}
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Pending Uploads</span>
          <span class="info-value">
            @if (db.totalPendingCount() > 0) {
              <span class="badge badge-warning">{{ db.totalPendingCount() }}</span>
            } @else {
              <span class="text-success">All synced</span>
            }
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Connection</span>
          <span class="info-value">
            <span class="status-dot" [class.online]="syncService.isOnline()"></span>
            {{ syncService.isOnline() ? 'Online' : 'Offline' }}
          </span>
        </div>

        <button
          class="btn btn-outline full-width"
          (click)="syncNow()"
          [disabled]="!syncService.isOnline() || syncService.isSyncing()"
        >
          {{ syncService.isSyncing() ? 'Syncing...' : 'Sync Now' }}
        </button>
      </div>
    </section>

    <!-- Cached Data Section -->
    <section class="section">
      <h2 class="section-title">Cached Data</h2>
      <div class="card">
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-value">{{ cacheStats().assets }}</span>
            <span class="stat-label">Assets</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ cacheStats().checklists }}</span>
            <span class="stat-label">Checklists</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ cacheStats().events }}</span>
            <span class="stat-label">Events</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ cacheStats().faults }}</span>
            <span class="stat-label">Faults</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Danger Zone Section -->
    <section class="section danger-section">
      <h2 class="section-title text-error">Danger Zone</h2>
      <div class="card danger-card">
        <p class="danger-text">
          Clearing data will delete all locally stored checks, faults, and cached data. 
          Unsynced data will be lost.
        </p>
        <button class="btn btn-danger full-width" (click)="clearAllData()">
          Clear All Local Data
        </button>
      </div>
    </section>

    <!-- App Info -->
    <div class="app-info">
      <p class="app-name">Pre-Shift Check PWA</p>
      <p class="app-version">Version 1.0.0</p>
    </div>
  </main>
</div>

